C51 COMPILER V9.54   3                                                                     03/08/2019 17:00:20 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 3
OBJECT MODULE PLACED IN .\Objects\3.obj
COMPILER INVOKED BY: E:\keil uVision4\C51\BIN\C51.EXE 3.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\3
                    -.lst) OBJECT(.\Objects\3.obj)

line level    source

   1          #include <reg52.h>
   2          #define uchar unsigned char
   3          #define uint unsigned int
   4          char s;
   5          uchar num=0; //抢答人编号，等于0代表没人抢答
   6          char time=20;      //抢答时间
   7          char datitime=30;      
   8          uint tt,t1;      
   9          bit flag, s_flag=1,b_flag, fall_flag;     //flag开始键按下，s_flag没有人抢答（1），b_flag蜂鸣器，fall_flag
             -有人违规 
  10          bit K_startcountflag, K_timecountflag;    //
  11          
  12          sbit K0=P3^0;           //开始按钮    //P3^0
  13          sbit beep=P1^5;         //蜂鸣器    //P1^5
  14          sbit rled=P2^0;     //发光二极管        //P2^0
  15          sbit K1=P1^0;           //8个按钮               //
  16          sbit K2=P1^1;
  17          sbit K3=P1^2;
  18          sbit K4=P1^3;
  19          sbit K5=P1^4;
  20          sbit K6=P3^5;           //P2^5
  21          sbit K7=P1^6;
  22          sbit K8=P1^7;
  23          sbit K_Time=P3^1;               //答题计时键        //P3^1
  24          sbit K_startcount=P3^2;         //开始抢答时间调整键//p3^2
  25          sbit K_timecount=P3^3;          //答题计时时间调整键//p3^3
  26          void delay(uchar ms)
  27                  //延时ms
  28          {
  29   1              uchar y;
  30   1              for(; ms>0;ms--)
  31   1              for(y=120;y>0;y--);
  32   1      }
  33          
  34          //数码管-表
  35          uchar code tabledu[ ]={0x3f,0x06,0x5b,0x4f,
  36          0x66,0x6d,0x7d,0x07,
  37          0x7f,0x6f,0x77,0x7c,
  38          0x39,0x5e,0x79,0x71
  39          };
  40          
  41          //数码管-位码
  42          uchar code tablewe[]={0x0C,0x08,0x04,0x00};   //{0x00,0x04,0x08,0x0C}
  43          void reset_1();
  44          
  45          //Timer0-初始化20ms
  46          void T0_Init(void)
  47          {
  48   1              TMOD=0X01;    
  49   1              TH0=(65536-2000)/256;    
  50   1              TL0=(65536-2000)%256;  
  51   1              TH1=(65536-2000)/256;   
  52   1              TL1=(65536-2000)%256;   
  53   1              ET0=1;   
C51 COMPILER V9.54   3                                                                     03/08/2019 17:00:20 PAGE 2   

  54   1              ET1=1;  
  55   1              EA=1;  
  56   1              P0=0;
  57   1      }
  58          
  59          //主持人按键扫描
  60          void Key_Scan( void)
  61          {
  62   1              if(K0==0)
  63   1              {
  64   2                      delay(10);//按键消抖
  65   2                      if(K0==0)
  66   2                      {
  67   3                              while(!K0);
  68   3                              TR0=1;
  69   3                              s=time;
  70   3                              tt=0;
  71   3                              flag=1;
  72   3                              s_flag=1;
  73   3                              b_flag=1;
  74   3                              num=0;
  75   3                              beep=1;
  76   3                              rled=1;   
  77   3                              fall_flag=0;   //???????
  78   3                              K_startcountflag=0;
  79   3                              K_timecountflag=0; 
  80   3                      }
  81   2              }
  82   1      }
  83          
  84          //8路按键扫描
  85          void Scan(void)
  86          {
  87   1              if(K1==0)
  88   1              {
  89   2                      delay(10);
  90   2                      if(K1==0)
  91   2                      {
  92   3                              while(!K1);
  93   3                              num=1;
  94   3                              TR0=0;
  95   3                              TR1=1;
  96   3                              s_flag=0;
  97   3                      }
  98   2              }
  99   1              if(K2==0)
 100   1              {
 101   2                      delay(10);
 102   2                      if(K2==0)
 103   2                      {
 104   3                              while(!K2);
 105   3                              num=2;
 106   3                              TR0=0;
 107   3                              TR1=1;
 108   3                              s_flag=0;
 109   3                      }
 110   2              }
 111   1      if(K3==0)
 112   1      {
 113   2      delay(10);
 114   2      if(K3==0)
 115   2      {
C51 COMPILER V9.54   3                                                                     03/08/2019 17:00:20 PAGE 3   

 116   3      while(!K3);
 117   3      num=3;
 118   3      TR0=0;
 119   3      TR1=1;
 120   3      s_flag=0;
 121   3      }}
 122   1      if(K4==0)
 123   1      {
 124   2      delay(10);
 125   2      if(K4==0)
 126   2      {
 127   3      while(!K4);
 128   3      num=4;
 129   3      TR0=0;
 130   3      TR1=1;
 131   3      s_flag=0;
 132   3      }}
 133   1      if(K5==0)
 134   1      {
 135   2      delay(10);
 136   2      if(K5==0)
 137   2      {
 138   3      while(!K5);
 139   3      num=5;
 140   3      TR0=0;
 141   3      TR1=1;
 142   3      s_flag=0;
 143   3      }}
 144   1      if(K6==0)
 145   1      {
 146   2      delay(10);
 147   2      if(K6==0)
 148   2      {
 149   3      while(!K6);
 150   3      num=6;
 151   3      TR0=0;
 152   3      TR1=1;
 153   3      s_flag=0;
 154   3      }}
 155   1      if(K7==0)
 156   1      {
 157   2      delay(10);
 158   2      if(K7==0)
 159   2      {
 160   3      while(!K7);
 161   3      num=7;
 162   3      TR0=0;
 163   3      TR1=1;
 164   3      s_flag=0;
 165   3      }}
 166   1      if(K8==0)
 167   1      {
 168   2      delay(10);
 169   2      if(K8==0)
 170   2      {
 171   3      while(!K8);
 172   3      num=8;
 173   3      TR0=0;
 174   3      TR1=1;
 175   3      s_flag=0;
 176   3      }    }}
 177          
C51 COMPILER V9.54   3                                                                     03/08/2019 17:00:20 PAGE 4   

 178          //显示
 179          void display (void)
 180          {
 181   1              if(flag==1)
 182   1              {       
 183   2                      if(num!=0)    //如果有人抢答，则显示相应的几号
 184   2                      {
 185   3                              P0=tabledu[num];  
 186   3                              P2=tablewe[0];
 187   3                              delay(2);
 188   3                              P0=0;
 189   3                              P2=0XFF;
 190   3                      }
 191   2                      else//否则没人抢答，则前面不显示几号
 192   2                      {
 193   3                              P0=0;
 194   3                              P2=0XFF;
 195   3                      }
 196   2                      
 197   2                      P0=tabledu[s/10];   //倒计时
 198   2                      P2=tablewe[2];
 199   2                      delay(2);
 200   2                      P0=0;
 201   2                      P2=0XFF;
 202   2                      P0=tabledu[s%10];
 203   2                      P2=tablewe[3];
 204   2                      delay(2);
 205   2                      P2=0XFF;
 206   2                      P0=0;
 207   2              }
 208   1      else    //如果开始键没有按下，则显示F FF(若有违规者，则显示违规号码及FF)或时间调整
 209   1      {
 210   2      if(fall_flag==1)    //违规
 211   2      {
 212   3      if(num!=0)
 213   3      {
 214   4      P0=tabledu[num];      //显示几号违规
 215   4      P2=tablewe[0];
 216   4      delay(2);
 217   4      P0=0;
 218   4      P2=0XFF;
 219   4      P0=tabledu[15];    //下面显示FF，表示违规
 220   4      P2=tablewe[2];
 221   4      delay(2);
 222   4      P0=0;      ///消隐
 223   4      P2=0XFF;
 224   4      P0=tabledu[15];
 225   4      P2=tablewe[3];
 226   4      delay(2);
 227   4      P0=0;
 228   4      P2=0XFF;
 229   4      }
 230   3      else
 231   3      {
 232   4      P0=0;
 233   4      P2=0XFF;
 234   4      }}
 235   2      else      //没有人违规才显示调整时间
 236   2      {
 237   3      if(K_startcountflag==1)
 238   3      {
 239   4      P0=0X6D; //第一位数码管显示’’5(s)’’(表示抢答事件调整)
C51 COMPILER V9.54   3                                                                     03/08/2019 17:00:20 PAGE 5   

 240   4      P2=tablewe[0];
 241   4      delay(2);
 242   4      P0=0;
 243   4      P2=0XFF;
 244   4      P0=tabledu[time/10]; //下面显示调整的抢答时间  
 245   4      P2=tablewe[2];
 246   4      delay(2);
 247   4      P0=0;
 248   4      P2=0XFF,
 249   4      P0=tabledu[time%10];
 250   4      P2=tablewe[3];
 251   4      delay(2);
 252   4      P0=0;
 253   4      P2=0XFF;
 254   4      }
 255   3      else if(K_timecountflag==1)
 256   3      {
 257   4      P0=0X07;  //第一位与第二位数码管合起来显示’’T’’，表示答题时间调整
 258   4      P2=tablewe[0];
 259   4      delay(2);
 260   4      P0=0;
 261   4      P2=0XFF;
 262   4      P0=0X31;
 263   4      P2=tablewe[1];
 264   4      delay(2);
 265   4      P0=0;
 266   4      P2=0XFF;
 267   4      P0=tabledu[datitime/10];
 268   4      P2=tablewe[2];
 269   4      delay(2);
 270   4      P0=0;
 271   4      P2=0XFF;
 272   4      P0=tabledu[datitime%10];
 273   4      P2=tablewe[3];
 274   4      delay(2);
 275   4      P0=0;
 276   4      P2=0XEF;
 277   4      }
 278   3      else     //否则显示 F FF
 279   3      {
 280   4      P0=tabledu[15];
 281   4      P2=tablewe[0];
 282   4      delay(2);
 283   4      P0=0;
 284   4      P0=tabledu[15];
 285   4      P2=tablewe[2];
 286   4      delay(2);
 287   4      P0=0;
 288   4      P2=0XFF;
 289   4      P0=tabledu[51];
 290   4      P2=tablewe[3];
 291   4      delay(2);
 292   4      P0=0;
 293   4      P2=0XFF;
 294   4      }     }     }}
 295          void Time_Scan(void)   //调整时间键扫描
 296          { 
 297   1              if(K_startcount==0)    //抢答时间调整
 298   1              {
 299   2                      delay(10);
 300   2                      if(K_startcount==0)
 301   2                      {
C51 COMPILER V9.54   3                                                                     03/08/2019 17:00:20 PAGE 6   

 302   3                              while(K_startcount==0);
 303   3                              time++;
 304   3                              if(time==50)
 305   3                              {
 306   4                              time=20;
 307   4                              }
 308   3                              K_startcountflag=1; //将抢答时间标志位置1
 309   3                              K_timecountflag=0; //同时关闭答题时间标志位
 310   3                      }
 311   2              }
 312   1              if(K_timecount==0)
 313   1              {
 314   2                      delay(10);
 315   2                      if(K_timecount==0)
 316   2                      {
 317   3                              while(!K_timecount);
 318   3                              datitime++;
 319   3                              if(datitime==60)
 320   3                              {
 321   4                              datitime=30;
 322   4                              }
 323   3                              K_timecountflag=1;
 324   3                              K_startcountflag=0;
 325   3                      }
 326   2              }
 327   1      }
 328          void main(void)
 329          {
 330   1              T0_Init();
 331   1              while(1)
 332   1              {
 333   2                      Key_Scan();    //开始键扫描
 334   2                      if((flag==0)&&(s_flag==1))    //当开始键没按下及没有人违规时才可进行时间调整
 335   2                      {
 336   3                              Time_Scan( );
 337   3                      }
 338   2                      if((flag==1)&&(s_flag==0)) //当开始键按下及有人抢答才进行开始回答计时倒计时
 339   2                      {
 340   3                              if(K_Time==0)
 341   3                              {
 342   4                                      delay(10);
 343   4                                      if(K_Time==0)
 344   4                                      {
 345   5                                              while (!K_Time);
 346   5                                              s=datitime;
 347   5                                              TR0=1;
 348   5                                              tt=0;
 349   5                                              TR1=1;
 350   5                                              if(K_Time==0)//复位开关
 351   5                                              {delay(10);
 352   6                                              reset_1();}
 353   5                                      }
 354   4                              }
 355   3                      }
 356   2              
 357   2                      if((flag==0)&&(s_flag==1))  ///违规
 358   2                      { 
 359   3                              Scan();
 360   3                              if(num!=0)    //开始键没有按下时，有人按下了抢答器，则置违规标志位
 361   3                              {
 362   4                                      fall_flag=1;
 363   4                                      rled=0;
C51 COMPILER V9.54   3                                                                     03/08/2019 17:00:20 PAGE 7   

 364   4                              }   
 365   3                      }
 366   2                      if((flag==1)&&(s_flag==1))    //如果开始键按下且抢答键没有人按下，则进行八路抢答键扫描
 367   2                      {
 368   3                              Scan();
 369   3                      }
 370   2                      display();  //显示到数码管上
 371   2              }
 372   1      }
 373          void timer0(void) interrupt 1
 374          {
 375   1      TH0=(65536-2000)/256;//2ms
 376   1      TL0=(65536-2000)%256;
 377   1      if(b_flag)   //开始（START）键按下，嘟一声（长1秒），表示开始抢答
 378   1      {
 379   2      beep= ~beep;
 380   2      }
 381   1      else
 382   1      beep=1;
 383   1      if(s<5)
 384   1      {
 385   2      if(s%2==0)
 386   2      {
 387   3      b_flag=1;
 388   3      rled=0;
 389   3      }
 390   2      else
 391   2      {
 392   3      b_flag=0;
 393   3      rled=1;
 394   3      }}
 395   1      tt++;
 396   1      if(tt==500)            //1s
 397   1      {
 398   2      tt=0;
 399   2      s--;   
 400   2      b_flag=0; //关闭开始键按下响1s的嘟声
 401   2      if(s==-1)
 402   2      reset_1();
 403   2      }}
 404          void reset_1(void)
 405          {
 406   1      s=time;
 407   1      TR0=0;
 408   1      flag=0;   
 409   1      s_flag=1;
 410   1      num=0;
 411   1      rled=1;         
 412   1      }
 413          void timer1(void)  interrupt 3     //???1????????????(?1s)
 414          {
 415   1      TH1=(65536-2000)/256;    //???T1?8????
 416   1      TL1=(65536-2000)%256;   //???T1?8????
 417   1      beep=~beep;
 418   1      t1++;
 419   1      if(t1==500)
 420   1      {  
 421   2      t1=0;
 422   2         TR1=0;}}
 423          
 424          

C51 COMPILER V9.54   3                                                                     03/08/2019 17:00:20 PAGE 8   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    967    ----
   CONSTANT SIZE    =     20    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      6    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
