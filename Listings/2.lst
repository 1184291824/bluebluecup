C51 COMPILER V9.54   2                                                                     03/02/2019 18:09:27 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 2
OBJECT MODULE PLACED IN .\Objects\2.obj
COMPILER INVOKED BY: E:\keil uVision4\C51\BIN\C51.EXE 2.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\2
                    -.lst) OBJECT(.\Objects\2.obj)

line level    source

   1          #include <reg52.h>
   2          #define uchar unsigned char
   3          #define uint unsigned int
   4          char s;
   5          uchar num=0; //抢答人编号，等于0代表没人抢答
   6          char time=20;      //抢答时间
   7          char datitime=30;      
   8          uint tt,t1;      
   9          bit flag, s_flag=1,b_flag, fall_flag;     //flag开始键按下，s_flag没有人抢答（1），b_flag蜂鸣器，fall_flag
             -有人违规 
  10          bit K_startcountflag, K_timecountflag;    //
  11          
  12          sbit K0=P3^0;           //开始按钮
  13          sbit beep=P3^7;         //蜂鸣器
  14          sbit rled=P3^1;     //发光二极管
  15          sbit K1=P1^0;           //8个按钮
  16          sbit K2=P1^1;
  17          sbit K3=P1^2;
  18          sbit K4=P1^3;
  19          sbit K5=P1^4;
  20          sbit K6=P1^5;
  21          sbit K7=P1^6;
  22          sbit K8=P1^7;
  23          sbit K_Time=P3^2;               //答题计时键
  24          sbit K_startcount=P3^3;         //开始抢答时间调整键
  25          sbit K_timecount=P3^4;          //答题计时时间调整键
  26          void delay(uchar ms)
  27                  //延时ms
  28          {
  29   1              uchar y;
  30   1              for(; ms>0;ms--)
  31   1              for(y=120;y>0;y--);
  32   1      }
  33          
  34          //数码管-表
  35          uchar code tabledu[ ]={0x3f,0x06,0x5b,0x4f,
  36          0x66,0x6d,0x7d,0x07,
  37          0x7f,0x6f,0x77,0x7c,
  38          0x39,0x5e,0x79,0x71
  39          };
  40          
  41          //数码管-位码
  42          uchar code tablewe[]={0xfe,0xfd,0xfb,0xf7};
  43          
  44          //Timer0-初始化20ms
  45          void T0_Init(void)
  46          {
  47   1              TMOD=0X01;    
  48   1              TH0=(65536-2000)/256;    
  49   1              TL0=(65536-2000)%256;  
  50   1              TH1=(65536-2000)/256;   
  51   1              TL1=(65536-2000)%256;   
  52   1              ET0=1;   
  53   1              ET1=1;  
C51 COMPILER V9.54   2                                                                     03/02/2019 18:09:27 PAGE 2   

  54   1              EA=1;  
  55   1              P0=0;
  56   1      }
  57          
  58          //主持人按键扫描
  59          void Key_Scan( void)
  60          {
  61   1              if(K0==0)
  62   1              {
  63   2                      delay(10);//按键消抖
  64   2                      if(K0==0)
  65   2                      {
  66   3                              while(!K0);
  67   3                              TR0=1;
  68   3                              s=time;
  69   3                              tt=0;
  70   3                              flag=1;
  71   3                              s_flag=1;
  72   3                              b_flag=1;
  73   3                              num=0;
  74   3                              beep=1;
  75   3                              rled=1;   
  76   3                              fall_flag=0;   //???????
  77   3                              K_startcountflag=0;
  78   3                              K_timecountflag=0; 
  79   3                      }
  80   2              }
  81   1      }
  82          
  83          //8路按键扫描
  84          void Scan(void)
  85          {
  86   1              if(K1==0)
  87   1              {
  88   2                      delay(10);
  89   2                      if(K1==0)
  90   2                      {
  91   3                              while(!K1);
  92   3                              num=1;
  93   3                              TR0=0;
  94   3                              TR1=1;
  95   3                              s_flag=0;
  96   3                      }
  97   2              }
  98   1              if(K2==0)
  99   1              {
 100   2                      delay(10);
 101   2                      if(K2==0)
 102   2                      {
 103   3                              while(!K2);
 104   3                              num=2;
 105   3                              TR0=0;
 106   3                              TR1=1;
 107   3                              s_flag=0;
 108   3                      }
 109   2              }
 110   1      if(K3==0)
 111   1      {
 112   2      delay(10);
 113   2      if(K3==0)
 114   2      {
 115   3      while(!K3);
C51 COMPILER V9.54   2                                                                     03/02/2019 18:09:27 PAGE 3   

 116   3      num=3;
 117   3      TR0=0;
 118   3      TR1=1;
 119   3      s_flag=0;
 120   3      }}
 121   1      if(K4==0)
 122   1      {
 123   2      delay(10);
 124   2      if(K4==0)
 125   2      {
 126   3      while(!K4);
 127   3      num=4;
 128   3      TR0=0;
 129   3      TR1=1;
 130   3      s_flag=0;
 131   3      }}
 132   1      if(K5==0)
 133   1      {
 134   2      delay(10);
 135   2      if(K5==0)
 136   2      {
 137   3      while(!K5);
 138   3      num=5;
 139   3      TR0=0;
 140   3      TR1=1;
 141   3      s_flag=0;
 142   3      }}
 143   1      if(K6==0)
 144   1      {
 145   2      delay(10);
 146   2      if(K6==0)
 147   2      {
 148   3      while(!K6);
 149   3      num=6;
 150   3      TR0=0;
 151   3      TR1=1;
 152   3      s_flag=0;
 153   3      }}
 154   1      if(K7==0)
 155   1      {
 156   2      delay(10);
 157   2      if(K7==0)
 158   2      {
 159   3      while(!K7);
 160   3      num=7;
 161   3      TR0=0;
 162   3      TR1=1;
 163   3      s_flag=0;
 164   3      }}
 165   1      if(K8==0)
 166   1      {
 167   2      delay(10);
 168   2      if(K8==0)
 169   2      {
 170   3      while(!K8);
 171   3      num=8;
 172   3      TR0=0;
 173   3      TR1=1;
 174   3      s_flag=0;
 175   3      }    }}
 176          
 177          //显示
C51 COMPILER V9.54   2                                                                     03/02/2019 18:09:27 PAGE 4   

 178          void display (void)
 179          {
 180   1              if(flag==1)
 181   1              {       
 182   2                      if(num!=0)    //如果有人抢答，则显示相应的几号
 183   2                      {
 184   3                              P0=tabledu[num];  
 185   3                              P2=tablewe[0];
 186   3                              delay(2);
 187   3                              P0=0;
 188   3                              P2=0XFF;
 189   3                      }
 190   2                      else//否则没人抢答，则前面不显示几号
 191   2                      {
 192   3                              P0=0;
 193   3                              P2=0XFF;
 194   3                      }
 195   2                      
 196   2                      P0=tabledu[s/10];   //倒计时
 197   2                      P2=tablewe[2];
 198   2                      delay(2);
 199   2                      P0=0;
 200   2                      P2=0XFF;
 201   2                      P0=tabledu[s%10];
 202   2                      P2=tablewe[3];
 203   2                      delay(2);
 204   2                      P2=0XFF;
 205   2                      P0=0;
 206   2              }
 207   1      else    //如果开始键没有按下，则显示F FF(若有违规者，则显示违规号码及FF)或时间调整
 208   1      {
 209   2      if(fall_flag==1)    //违规
 210   2      {
 211   3      if(num!=0)
 212   3      {
 213   4      P0=tabledu[num];      //显示几号违规
 214   4      P2=tablewe[0];
 215   4      delay(2);
 216   4      P0=0;
 217   4      P2=0XFF;
 218   4      P0=tabledu[15];    //下面显示FF，表示违规
 219   4      P2=tablewe[2];
 220   4      delay(2);
 221   4      P0=0;      ///消隐
 222   4      P2=0XFF;
 223   4      P0=tabledu[15];
 224   4      P2=tablewe[3];
 225   4      delay(2);
 226   4      P0=0;
 227   4      P2=0XFF;
 228   4      }
 229   3      else
 230   3      {
 231   4      P0=0;
 232   4      P2=0XFF;
 233   4      }}
 234   2      else      //没有人违规才显示调整时间
 235   2      {
 236   3      if(K_startcountflag==1)
 237   3      {
 238   4      P0=0X6D; //第一位数码管显示’’5(s)’’(表示抢答事件调整)
 239   4      P2=tablewe[0];
C51 COMPILER V9.54   2                                                                     03/02/2019 18:09:27 PAGE 5   

 240   4      delay(2);
 241   4      P0=0;
 242   4      P2=0XFF;
 243   4      P0=tabledu[time/10]; //下面显示调整的抢答时间  
 244   4      P2=tablewe[2];
 245   4      delay(2);
 246   4      P0=0;
 247   4      P2=0XFF,
 248   4      P0=tabledu[time%10];
 249   4      P2=tablewe[3];
 250   4      delay(2);
 251   4      P0=0;
 252   4      P2=0XFF;
 253   4      }
 254   3      else if(K_timecountflag==1)
 255   3      {
 256   4      P0=0X07;  //第一位与第二位数码管合起来显示’’T’’，表示答题时间调整
 257   4      P2=tablewe[0];
 258   4      delay(2);
 259   4      P0=0;
 260   4      P2=0XFF;
 261   4      P0=0X31;
 262   4      P2=tablewe[1];
 263   4      delay(2);
 264   4      P0=0;
 265   4      P2=0XFF;
 266   4      P0=tabledu[datitime/10];
 267   4      P2=tablewe[2];
 268   4      delay(2);
 269   4      P0=0;
 270   4      P2=0XFF;
 271   4      P0=tabledu[datitime%10];
 272   4      P2=tablewe[3];
 273   4      delay(2);
 274   4      P0=0;
 275   4      P2=0XEF;
 276   4      }
 277   3      else     //否则显示 F FF
 278   3      {
 279   4      P0=tabledu[15];
 280   4      P2=tablewe[0];
 281   4      delay(2);
 282   4      P0=0;
 283   4      P0=tabledu[15];
 284   4      P2=tablewe[2];
 285   4      delay(2);
 286   4      P0=0;
 287   4      P2=0XFF;
 288   4      P0=tabledu[51];
 289   4      P2=tablewe[3];
 290   4      delay(2);
 291   4      P0=0;
 292   4      P2=0XFF;
 293   4      }     }     }}
 294          void Time_Scan(void)   //调整时间键扫描
 295          { 
 296   1      if(K_startcount==0)    //抢答时间调整
 297   1      {
 298   2      delay(10);
 299   2      if(K_startcount==0)
 300   2      {
 301   3      while(!K_startcount==0);
C51 COMPILER V9.54   2                                                                     03/02/2019 18:09:27 PAGE 6   

 302   3      time++;
 303   3      if(time==50)
 304   3      {
 305   4      time=20;
 306   4      }
 307   3      K_startcountflag=1; //将抢答时间标志位置1
 308   3         K_timecountflag=0; //同时关闭答题时间标志位
 309   3      }}
 310   1      if(K_timecount==0)
 311   1      {
 312   2      delay(10);
 313   2      if(K_timecount==0)
 314   2      {
 315   3      while(!K_timecount);
 316   3      datitime++;
 317   3      if(datitime==60)
 318   3      {
 319   4      datitime=30;
 320   4      }
 321   3      K_timecountflag=1;
 322   3      K_startcountflag=0;
 323   3      }}}
 324          void main(void)
 325          {
 326   1      T0_Init();
 327   1      while(1)
 328   1      {
 329   2      Key_Scan();    //开始键扫描
 330   2      if((flag==0)&(s_flag==1))    //当开始键没按下及没有人违规时才可进行时间调整
 331   2      {
 332   3      Time_Scan( );
 333   3      }
 334   2      if((flag==1)&(s_flag==0)) //当开始键按下及有人抢答才进行开始回答计时倒计时
 335   2         if(K_Time==0)
 336   2      {
 337   3      delay(10);
 338   3      if(K_Time==0)
 339   3      {
 340   4        while (!K_Time);
 341   4        s=datitime;
 342   4        TR0=1;
 343   4        tt=0;
 344   4        TR1=1;
 345   4      }}}
 346   1         if((flag==0)&(s_flag==1))  ///违规
 347   1      { 
 348   2        Scan();
 349   2        if(num!=0)    //开始键没有按下时，有人按下了抢答器，则置违规标志位
 350   2      {
 351   3         fall_flag=1;
 352   3         rled=0;
 353   3      }   }
 354   1      if((flag==1)&(s_flag==1))    //如果开始键按下且抢答键没有人按下，则进行八路抢答键扫描
 355   1      {
 356   2      Scan();
 357   2      }
 358   1      display();  //显示到数码管上
 359   1      }
 360          void timer0(void) interrupt 1
 361          {
 362   1      TH0=(65536-2000)/256;//2ms
 363   1      TL0=(65536-2000)%256;
C51 COMPILER V9.54   2                                                                     03/02/2019 18:09:27 PAGE 7   

 364   1      if(b_flag)   //开始（START）键按下，嘟一声（长1秒），表示开始抢答
 365   1      {
 366   2      beep= ~beep;
 367   2      }
 368   1      else
 369   1      beep=1;
 370   1      if(s<5)
 371   1      {
 372   2      if(s%2==0)
 373   2      {
 374   3      b_flag=1;
 375   3      rled=0;
 376   3      }
 377   2      else
 378   2      {
 379   3      b_flag=0;
 380   3      rled=1;
 381   3      }}
 382   1      tt++;
 383   1      if(tt==500)            //1s
 384   1      {
 385   2      tt=0;
 386   2      s--;   
 387   2      b_flag=0; //关闭开始键按下响1s的嘟声
 388   2      if(s==-1)
 389   2      {
 390   3      s=20;
 391   3      TR0=0;
 392   3      flag=0;   
 393   3      s_flag=1;
 394   3      num=0;
 395   3      rled=1;   
 396   3      }}}
 397          void timer1(void)  interrupt 3     //???1????????????(?1s)
 398          {
 399   1      TH1=(65536-2000)/256;    //???T1?8????
 400   1      TL1=(65536-2000)%256;   //???T1?8????
 401   1      beep=~beep;
 402   1      t1++;
 403   1      if(t1==500)
 404   1      {  
 405   2      t1=0;
 406   2         TR1=0;}}
 407          
 408          
*** WARNING C294 IN LINE 346 OF 2.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    957    ----
   CONSTANT SIZE    =     20    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      6    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
