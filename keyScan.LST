C51 COMPILER V9.01   KEYSCAN                                                               03/15/2019 13:35:34 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE KEYSCAN
OBJECT MODULE PLACED IN keyScan.OBJ
COMPILER INVOKED BY: E:\keil C51\C51\BIN\C51.EXE keyScan.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          **********************************************************************
   3          *                         头文件包含
   4          **********************************************************************
   5          */
   6          #include "keyScan.h"
   7          
   8          
   9          /*
  10          **********************************************************************
  11          *                         本地宏定义
  12          **********************************************************************
  13          */
  14          
  15          
  16          /*
  17          **********************************************************************
  18          *                         本地全局变量
  19          **********************************************************************
  20          */
  21          sbit key1 = P3^0;               //独立按键s2
  22          sbit key2 = P3^1;               //独立按键s3
  23          sbit key3 = P3^2;               //独立按键s4
  24          sbit key4 = P3^3;               //独立按键s5
  25          
  26          sbit hot1 = P1^0;               //热键1
  27          sbit hot2 = P1^1;               //热键2
  28          sbit hot3 = P1^2;               //热键3
  29          sbit hot4 = P1^3;               //热键4
  30          sbit hot5 = P1^4;               //热键5
  31          sbit hot6 = P1^5;               //热键6
  32          sbit hot7 = P1^6;               //热键7
  33          sbit hot8 = P1^7;               //热键8
  34          
  35          
  36          /*
  37          **********************************************************************
  38          *                         函数原型声明
  39          **********************************************************************
  40          */
  41          int control_key_scan(void);
  42          int hot_key_scan(u16 flag);
  43          void delay10ms(void);
  44          
  45          /*
  46          **********************************************************************
  47          *  函数名：control_key_scan
  48          *  作用：控制按键扫描
  49          *  返回：被按下的按键值，如果没有按键按下返回0
  50          **********************************************************************
  51          */
  52          int control_key_scan(void)
  53          {
  54   1              if( key1 == 0 )
  55   1              {
C51 COMPILER V9.01   KEYSCAN                                                               03/15/2019 13:35:34 PAGE 2   

  56   2                      delay10ms();
  57   2                      if ( key1 == 0 )
  58   2                      {
  59   3                              return 1;
  60   3                      }
  61   2              }
  62   1      
  63   1              if( key2 == 0 )
  64   1              {
  65   2                      delay10ms();
  66   2                      if ( key2 == 0 )
  67   2                      {
  68   3                              return 2;
  69   3                      }
  70   2              }
  71   1      
  72   1              if( key3 == 0 )
  73   1              {
  74   2                      delay10ms();
  75   2                      if ( key3 == 0 )
  76   2                      {
  77   3                              return 3;
  78   3                      }
  79   2              }
  80   1      
  81   1              if( key4 == 0 )
  82   1              {
  83   2                      delay10ms();
  84   2                      if ( key4 == 0 )
  85   2                      {
  86   3                              return 4;
  87   3                      }
  88   2              }
  89   1      
  90   1              return 0;
  91   1      }
  92          
  93          
  94          
  95          /*
  96          **********************************************************************
  97          *  函数名：hot_key_scan
  98          *  作用：8路热键扫描
  99          *  返回：被按下的按键值，如果没有按键按下返回0
 100          **********************************************************************
 101          */
 102          int hot_key_scan(u16 flag_hot_scan)
 103          {       
 104   1              if(flag_hot_scan==0) return 0;
 105   1              if( hot1 == 0 )
 106   1              {
 107   2                      delay10ms();
 108   2                      if ( hot1 == 0 )
 109   2                      {
 110   3                              return 1;
 111   3                      }
 112   2              }
 113   1      
 114   1              if( hot2 == 0 )
 115   1              {
 116   2                      delay10ms();
 117   2                      if ( hot2 == 0 )
C51 COMPILER V9.01   KEYSCAN                                                               03/15/2019 13:35:34 PAGE 3   

 118   2                      {
 119   3                              return 2;
 120   3                      }
 121   2              }
 122   1      
 123   1              if( hot3 == 0 )
 124   1              {
 125   2                      delay10ms();
 126   2                      if ( hot3 == 0 )
 127   2                      {
 128   3                              return 3;
 129   3                      }
 130   2              }
 131   1      
 132   1              if( hot4 == 0 )
 133   1              {
 134   2                      delay10ms();
 135   2                      if ( hot4 == 0 )
 136   2                      {
 137   3                              return 4;
 138   3                      }
 139   2              }
 140   1      
 141   1              if( hot5 == 0 )
 142   1              {
 143   2                      delay10ms();
 144   2                      if ( hot5 == 0 )
 145   2                      {
 146   3                              return 5;
 147   3                      }
 148   2              }
 149   1      
 150   1              if( hot6 == 0 )
 151   1              {
 152   2                      delay10ms();
 153   2                      if ( hot6 == 0 )
 154   2                      {
 155   3                              return 6;
 156   3                      }
 157   2              }
 158   1      
 159   1              if( hot7 == 0 )
 160   1              {
 161   2                      delay10ms();
 162   2                      if ( hot7 == 0 )
 163   2                      {
 164   3                              return 7;
 165   3                      }
 166   2              }
 167   1      
 168   1              if( hot8 == 0 )
 169   1              {
 170   2                      delay10ms();
 171   2                      if ( hot8 == 0 )
 172   2                      {
 173   3                              return 8;
 174   3                      }
 175   2              }
 176   1      
 177   1              return 0;
 178   1      }
 179          
C51 COMPILER V9.01   KEYSCAN                                                               03/15/2019 13:35:34 PAGE 4   

 180          
 181          
 182          /*
 183          **********************************************************************
 184          *  函数名：delay10ms
 185          *  作用：等待10ms
 186          *  返回：无
 187          **********************************************************************
 188          */
 189          void delay10ms(void)   //误差 0us
 190          {
 191   1          unsigned char a,b,c;
 192   1          for(c=5;c>0;c--)
 193   1              for(b=4;b>0;b--)
 194   1                  for(a=248;a>0;a--);
 195   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    196    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
