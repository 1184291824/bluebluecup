C51 COMPILER V9.01   TIMER                                                                 03/15/2019 13:35:34 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN timer.OBJ
COMPILER INVOKED BY: E:\keil C51\C51\BIN\C51.EXE timer.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          #include <common.h>
   3          
   4          
   5          
   6          sbit beep = P2^3;
   7          
   8          
   9          //Timer0-初始化20ms
  10          /*********************************************************************
  11          * 函 数 名       : Timer0Init
  12          * 函数功能               : 定时器0初始化函数
  13          * 参数列表       : 无
  14          * 函数输出       : 无
  15          *********************************************************************/
  16          void Timer0Init(void)
  17          {
  18   1              TMOD &= 0xf0;           // T0设为定时器模式，仅用TR0控制打开
  19   1              TMOD |= 0x01;           // T0选择为工作模式1：16位定时器、TH0 TL0全使用
  20   1      
  21   1              TH0 = 0xd8;                     // 使用单片机小精灵计算10ms定时的TH0、TL0初值
  22   1              TL0 = 0xf0;     
  23   1              ET0 = 1;                        // 打开定时器0中断允许
  24   1              EA = 1;                         // 打开总中断
  25   1              TR0 = 0;                        // 暂停计时                     
  26   1      }
  27          
  28          
  29          
  30          /*********************************************************************
  31          * 函 数 名       : Timer0Isr
  32          * 函数功能               : 定时器0中断处理程序
  33          * 参数列表       : 无
  34          * 函数输出       : 无
  35          *********************************************************************/
  36          
  37          int t1=3000;
  38          void Timer0Isr(void) interrupt 1
  39          {
  40   1              TH0 = 0xd8;                             // 使用单片机小精灵计算10ms定时的TH0、TL0初值
  41   1              TL0 = 0xf0;     
  42   1              
  43   1              //if (t1++ >= 10)               // 每隔10*10ms = 100ms
  44   1              //{
  45   1                      t1--;                   //t1 减一
  46   1              //}
  47   1      }
  48          
  49          
  50          /*********************************************************************
  51          * 函 数 名       : Timer1Init
  52          * 函数功能               : 定时器1初始化函数
  53          * 参数列表       : 无
  54          * 函数输出       : 无
  55          *********************************************************************/
C51 COMPILER V9.01   TIMER                                                                 03/15/2019 13:35:34 PAGE 2   

  56          void Timer1Init(void)
  57          {
  58   1              TMOD &= 0x0f;           // T1设为定时器模式，仅用TR1控制打开
  59   1              TMOD |= 0x10;           // T1选择为工作模式1：16位定时器、TH1 TL1全使用
  60   1      
  61   1              TH1 = 0xd8;                     // 使用单片机小精灵计算10ms定时的TH1、TL1初值
  62   1              TL1 = 0xf0;     
  63   1              ET1 = 1;                        // 打开定时器1中断允许
  64   1              EA = 1;                         // 打开总中断
  65   1              TR1 = 0;                        // 暂停计时                     
  66   1      }
  67          
  68          
  69          
  70          /*********************************************************************
  71          * 函 数 名       : Timer1Isr
  72          * 函数功能               : 定时器0中断处理程序
  73          * 参数列表       : 无
  74          * 函数输出       : 无
  75          *********************************************************************/
  76          int t2=50;
  77          void Timer1Isr(void) interrupt 3
  78          {
  79   1              TH1 = 0xd8;                             // 使用单片机小精灵计算10ms定时的TH1、TL1初值
  80   1              TL1 = 0xf0;
  81   1              beep=0; 
  82   1              
  83   1              if (t2-- < 0)           // 每隔100*10ms = 1000ms
  84   1              {
  85   2                      beep=1;
  86   2                      t2 = 50;                        
  87   2                      TR1=0;  
  88   2              }
  89   1      }
  90          
  91          
  92          
  93          //返回t1的值
  94          int get_t1(void)
  95          {       if(t1<0)
  96   1              {
  97   2                      t1=-1;
  98   2                      TR0 = 0;         //暂停定时器
  99   2              }
 100   1              return t1;
 101   1      }
 102          
 103          
 104          //设置t1的值
 105          void set_t1(u16 x)
 106          {       
 107   1              t1=x;
 108   1      }
 109          
 110          //开启定时器0
 111          void start_timer0(void)
 112          {
 113   1              TR0 = 1;                        // 开始计时
 114   1      }
 115          
 116          //关闭定时器0
 117          void stop_timer0(void)
C51 COMPILER V9.01   TIMER                                                                 03/15/2019 13:35:34 PAGE 3   

 118          {
 119   1              TR0 = 0;                        // 停止计时
 120   1      }
 121          
 122          //开启定时器1
 123          void start_timer1(void)
 124          {
 125   1              TR1 = 1;                        // 开始计时
 126   1      }
 127          
 128          //关闭定时器1
 129          void stop_timer1(void)
 130          {
 131   1              TR1 = 0;                        // 停止计时
 132   1      }
 133          
 134          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    148    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
