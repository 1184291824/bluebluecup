C51 COMPILER V9.01   TIMER                                                                 03/10/2019 00:58:07 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN timer.OBJ
COMPILER INVOKED BY: E:\keil C51\C51\BIN\C51.EXE timer.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          #include <common.h>
   3          
   4          //Timer0-初始化20ms
   5          /*********************************************************************
   6          * 函 数 名       : Timer0Init
   7          * 函数功能               : 定时器0初始化函数
   8          * 参数列表       : 无
   9          * 函数输出       : 无
  10          *********************************************************************/
  11          void Timer0Init(void)
  12          {
  13   1              TMOD &= 0xf0;           // T0设为定时器模式，仅用TR0控制打开
  14   1              TMOD |= 0x01;           // T0选择为工作模式1：16位定时器、TH0 TL0全使用
  15   1      
  16   1              TH0 = 0xd8;                     // 使用单片机小精灵计算10ms定时的TH0、TL0初值
  17   1              TL0 = 0xf0;     
  18   1              ET0 = 1;                        // 打开定时器0中断允许
  19   1              EA = 1;                         // 打开总中断
  20   1              TR0 = 0;                        // 暂停计时                     
  21   1      }
  22          
  23          
  24          
  25          /*********************************************************************
  26          * 函 数 名       : Timer0Isr
  27          * 函数功能               : 定时器0中断处理程序
  28          * 参数列表       : 无
  29          * 函数输出       : 无
  30          *********************************************************************/
  31          
  32          int t1=3000;
  33          void Timer0Isr(void) interrupt 1
  34          {
  35   1              TH0 = 0xd8;                             // 使用单片机小精灵计算10ms定时的TH0、TL0初值
  36   1              TL0 = 0xf0;     
  37   1              
  38   1              //if (t1++ >= 10)               // 每隔10*10ms = 100ms
  39   1              //{
  40   1                      t1--;                   //t1 减一
  41   1              //}
  42   1      }
  43          
  44          //返回t1的值
  45          int get_t1(void)
  46          {       if(t1<0)
  47   1              {
  48   2                      t1=0;
  49   2                      TR0 = 0;         //暂停定时器
  50   2              }
  51   1              return t1;
  52   1      }
  53          
  54          
  55          //设置t1的值
C51 COMPILER V9.01   TIMER                                                                 03/10/2019 00:58:07 PAGE 2   

  56          void set_t1(u16 x)
  57          {       
  58   1              t1=x;
  59   1      }
  60          
  61          //开启定时器0
  62          void start_timer0(void)
  63          {
  64   1              TR0 = 1;                        // 开始计时
  65   1      }
  66          
  67          //关闭定时器0
  68          void stop_timer0(void)
  69          {
  70   1              TR0 = 0;                        // 开始计时
  71   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     70    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
