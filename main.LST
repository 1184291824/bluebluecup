C51 COMPILER V9.01   MAIN                                                                  03/10/2019 00:58:07 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\keil C51\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************
   2                                                  抢答器使用说明
   3                  【功能介绍】：
   4                          1. 本抢答器具有多种功能
   5                          2. 模式1：基本倒计时抢答模式，主持人按下开始按钮后，选手开始抢答
   6                          3. 模式2：答题时间倒计时模式，主持人按下开始按钮后，选手开始作答
   7                          4. 模式3：查看选手得分
   8          
   9          
  10                  【按键说明】：
  11                          
  12                          [S5]:切换模式按钮
  13                          
  14                          {模式 1}：
  15                                  [S2]:开启定时器
  16                                  [S3]:暂停定时器
  17                          
  18                          {模式 2}：
  19                                  [S2]:开启定时器
  20                                  [S3]:回答错误
  21                                  [S4]:回答正确（注意：按一次加分一次，请勿多次按下）
  22                          {模式 3}：
  23                                  无效
  24                          {模式 4}：                                                
  25          **********************************************************************/
  26          
  27          /*
  28          **********************************************************************
  29          *                         头文件包含
  30          **********************************************************************
  31          */
  32          #include "lcd1602.h"
  33          #include "timer.h"
  34          #include "keyScan.h"
  35          
  36          
  37          /*
  38          **********************************************************************
  39          *                         本地宏定义
  40          **********************************************************************
  41          */
  42          
  43          
  44          /*
  45          **********************************************************************
  46          *                         本地全局变量
  47          **********************************************************************
  48          */
  49          
  50          char str_time[5] = "00.00";                     //时间字符串
  51          char int_str[]="0123456789";            //数字转字符串
  52          int score[8]={0,0,0,0,0,0,0,0};         //成绩数组
  53          int key = 0;                                            //哪个按键被按下
  54          int hot_key     = 0;                                    //哪个热键被按下
  55          u8 hot_key_temp;                                        //用于临时的热键存储
C51 COMPILER V9.01   MAIN                                                                  03/10/2019 00:58:07 PAGE 2   

  56          int mode = 1;                                           //模式选择，
  57          int flag_hot_scan = 0;                          //hot_scan函数是否运行标志
  58          u8 time_set_flag=1;                                     //调整的是哪个时间，1：抢答时间；-1：回答时间
  59          
  60          int time_fight = 3000;                          //抢答时间
  61          int time_answer = 3000;                         //答题时间
  62          /*
  63          **********************************************************************
  64          *                         函数原型声明
  65          **********************************************************************
  66          */
  67          void display_time(u16 x, u16 y);
  68          void change_mode();
  69          void display_key(u16 x, u16 y);
  70          void display_hot_key(u16 x, u16 y);
  71          void display_score(void);
  72          
  73          void MODE1();
  74          void MODE2();
  75          
  76          
  77          void delay10ms(void);
  78          
  79          /*********************************************************************
  80          * 函 数 名       : display_time
  81          * 函数功能               : 显示倒计时
  82          * 参数列表       : 无
  83          * 函数输出       : 无
  84          *********************************************************************/
  85          void display_time(u16 x, u16 y)
  86          {
  87   1              str_time[4]=int_str[get_t1()%10];
  88   1              str_time[3]=int_str[get_t1()/10%10];
  89   1              str_time[1]=int_str[get_t1()/100%10];
  90   1              str_time[0]=int_str[get_t1()/1000];
  91   1              Lcd1602ShowStr(x,y,str_time); 
  92   1      }
  93          /*********************************************************************
  94          * 函 数 名       : display_key
  95          * 函数功能               : 显示哪个按键被按下（用于调试展示）
  96          * 参数列表       : 无
  97          * 函数输出       : 无
  98          *********************************************************************/
  99          void display_key(u16 x, u16 y)
 100          {
 101   1              key = control_key_scan();
 102   1              switch(key)
 103   1              {
 104   2                      case 1:Lcd1602ShowStr(x,y,"key1");break;
 105   2                      case 2:Lcd1602ShowStr(x,y,"key2");break;
 106   2                      case 3:Lcd1602ShowStr(x,y,"key3");break;
 107   2                      case 4:Lcd1602ShowStr(x,y,"key4");break;
 108   2                      default:Lcd1602ShowStr(x,y,"None");break;
 109   2              }        
 110   1      }
 111          
 112          /*********************************************************************
 113          * 函 数 名       : display_hot_key
 114          * 函数功能               : 显示哪个按键被按下（用于调试展示）
 115          * 参数列表       : 无
 116          * 函数输出       : 无
 117          *********************************************************************/
C51 COMPILER V9.01   MAIN                                                                  03/10/2019 00:58:07 PAGE 3   

 118          void display_hot_key(u16 x, u16 y)
 119          {
 120   1              Lcd1602ShowStr(x,y,"user ");
 121   1              Lcd1602ShowChar(x+5,y,int_str[hot_key]);
 122   1              Lcd1602ShowStr(x+7,y,"bingo!!");         
 123   1      }
 124          
 125          
 126          /*********************************************************************
 127          * 函 数 名       : display_score
 128          * 函数功能               : 显示哪个按键被按下（用于调试展示）
 129          * 参数列表       : 无
 130          * 函数输出       : 无
 131          *********************************************************************/
 132          void display_score(void)
 133          {
 134   1              u8 x=0,y=0,i=0;
 135   1              for(i=0;i<8;i++){
 136   2      //              Lcd1602ShowChar(x++,y,int_str[i+1]);
 137   2                      Lcd1602ShowStr(x++,y,"[");
 138   2                      Lcd1602ShowChar(x++,y,int_str[score[i]/10]);
 139   2                      Lcd1602ShowChar(x++,y,int_str[score[i]%10]);
 140   2                      Lcd1602ShowStr(x++,y,"]");
 141   2                      if (x>=16){
 142   3                              x=0;
 143   3                              y++;
 144   3                      }
 145   2              }        
 146   1      }
 147          
 148          
 149          /*********************************************************************
 150          * 函 数 名       : change_mode
 151          * 函数功能               : 改变模式
 152          * 参数列表       : 无
 153          * 函数输出       : 无
 154          *********************************************************************/
 155          void change_mode()
 156          {       
 157   1              if (control_key_scan() == 4)
 158   1              {
 159   2                      while(control_key_scan()!=0);
 160   2                      mode++;
 161   2                      if (mode>4){mode=1;}
 162   2                      clear_screen();  //清空屏幕
 163   2                      stop_timer0();   //关闭定时器
 164   2                      if(mode==1)
 165   2                              set_t1(time_fight);      //倒计时归零
 166   2                      else if(mode==2)
 167   2                              set_t1(time_answer);     //倒计时归零
 168   2                      else if(mode==4)
 169   2                              set_t1(time_fight);      //倒计时归零
 170   2                      flag_hot_scan = 0;       //关闭热键扫描
 171   2                              
 172   2              }        
 173   1      }
 174          
 175          
 176          /*********************************************************************
 177          * 函 数 名       : MODE1
 178          * 函数功能               : 抢答模式
 179          * 参数列表       : 无
C51 COMPILER V9.01   MAIN                                                                  03/10/2019 00:58:07 PAGE 4   

 180          * 函数输出       : 无
 181          *********************************************************************/
 182          void MODE1()
 183          {
 184   1              Lcd1602ShowStr(0,0,"time:");     //显示倒计时
 185   1              display_time(5,0);
 186   1              Lcd1602ShowStr(11,0,"MODE1");    //显示模式
 187   1              if (key==1){    //如果开始键被按下
 188   2                      start_timer0();          //开启定时器，开始倒计时
 189   2                      flag_hot_scan = 1;       //开启热键扫描
 190   2              }
 191   1              if (key==2){    //如果暂停键被按下
 192   2                      stop_timer0();           //关闭定时器，暂停倒计时
 193   2                      flag_hot_scan = 0;       //关闭热键扫描
 194   2              }
 195   1              
 196   1              hot_key_temp = hot_key_scan(flag_hot_scan);
 197   1              if (hot_key_temp){       //如果扫描到热键被按下
 198   2                      while(hot_key_scan(flag_hot_scan)!=0);
 199   2                      hot_key = hot_key_temp;
 200   2                      flag_hot_scan = 0;                               //停止热键扫描
 201   2                      stop_timer0();                                   //停止定时器的倒计时
 202   2                      display_hot_key(1,1);                    //显示抢答成功的用户
 203   2              }
 204   1              if (get_t1()==0){
 205   2                      flag_hot_scan = 0;       //关闭热键扫描
 206   2                      Lcd1602ShowStr(2,1,"--Time Out--");        //显示时间到了
 207   2              }
 208   1      }
 209          
 210          
 211          /*********************************************************************
 212          * 函 数 名       : MODE2
 213          * 函数功能               : 答题模式
 214          * 参数列表       : 无
 215          * 函数输出       : 无
 216          *********************************************************************/
 217          void MODE2()
 218          {
 219   1              Lcd1602ShowStr(0,0,"time:");     //显示倒计时
 220   1              display_time(5,0);
 221   1              Lcd1602ShowStr(11,0,"MODE2");    //显示模式
 222   1              if (key==1){    //如果开始键被按下
 223   2                      start_timer0();          //开启定时器，开始倒计时
 224   2              }
 225   1              if (key==2){    //如果答错键被按下
 226   2                      while(control_key_scan()!=0);   //等待按键抬起
 227   2                      stop_timer0();           //关闭定时器，暂停倒计时
 228   2                      Lcd1602ShowStr(0,1,"Your Are Wrong!");
 229   2              }
 230   1              if (key==3){    //如果答对键被按下
 231   2                      while(control_key_scan()!=0);   //等待按键抬起
 232   2                      stop_timer0();           //关闭定时器，暂停倒计时
 233   2                      score[hot_key-1] += 5;    //答对人的分数加5
 234   2                      Lcd1602ShowStr(0,1,"Your Are Right!");
 235   2              }
 236   1              if (get_t1()==0){
 237   2                      Lcd1602ShowStr(2,1,"--Time Out--");        //显示时间到了
 238   2              }
 239   1      }
 240          
 241          
C51 COMPILER V9.01   MAIN                                                                  03/10/2019 00:58:07 PAGE 5   

 242          /*********************************************************************
 243          * 函 数 名       : MODE4
 244          * 函数功能               : 答题模式
 245          * 参数列表       : 无
 246          * 函数输出       : 无
 247          *********************************************************************/
 248          void MODE4()
 249          {
 250   1              Lcd1602ShowStr(3,0,"Time Set");
 251   1              if(time_set_flag==1){
 252   2                      set_t1(time_fight);
 253   2                      Lcd1602ShowStr(0,1,"Fight  Time");
 254   2              }
 255   1              else{
 256   2                      set_t1(time_answer);
 257   2                      Lcd1602ShowStr(0,1,"Answer Time");
 258   2              }
 259   1              if(key == 3){                                                           //key3切换调整模式
 260   2                      while(control_key_scan()!=0);
 261   2                      time_set_flag = -time_set_flag;
 262   2              }
 263   1              else if(key == 1){                                                      //key1用来增加时间
 264   2                      while(control_key_scan()!=0);
 265   2                      if(time_set_flag==1){
 266   3                              time_fight += 100;
 267   3                              set_t1(time_fight);     
 268   3                      }
 269   2                      else{
 270   3                              time_answer += 100;
 271   3                              set_t1(time_answer);    
 272   3                      }
 273   2              }
 274   1              else if(key == 2){                                                 //key2用来减少时间
 275   2                      while(control_key_scan()!=0);
 276   2                      if(time_set_flag==1){
 277   3                              if(time_fight>0){
 278   4                                      time_fight -= 100;
 279   4                                      set_t1(time_fight);
 280   4                              }       
 281   3                      }
 282   2                      else{
 283   3                              if(time_answer>0){
 284   4                                      time_answer -= 100;
 285   4                                      set_t1(time_answer);
 286   4                              }       
 287   3                      }       
 288   2              }
 289   1              display_time(11,1);
 290   1      }
 291          
 292          
 293          
 294          /*********************************************************************
 295          * 函 数 名       : main
 296          * 函数功能               : 主函数
 297          * 参数列表       : 无
 298          * 函数输出       : 无
 299          *********************************************************************/
 300          void main(void)
 301          {
 302   1              Lcd1602Init();
 303   1              Timer0Init();
C51 COMPILER V9.01   MAIN                                                                  03/10/2019 00:58:07 PAGE 6   

 304   1              while(1){
 305   2                      change_mode();
 306   2                      key = control_key_scan();
 307   2                      
 308   2                      switch(mode){                   //模式查验
 309   3                              case 1:{                        //如果是模式1的话
 310   4                                      MODE1();         
 311   4                                      break;
 312   4                              }
 313   3                              case 2:{
 314   4                                      MODE2();
 315   4                                      break;
 316   4                              }
 317   3                              case 3:{
 318   4                                      display_score();                                         //显示分数
 319   4                                      break;
 320   4                              }
 321   3                              case 4:{
 322   4                                      MODE4();                                         //显示分数
 323   4                                      break;
 324   4                              }
 325   3                      }
 326   2              }
 327   1      }
 328          
 329          
 330          
 331          
 332          
 333          
 334          
 335          
 336          
 337          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1024    ----
   CONSTANT SIZE    =    139    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     46      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
