C51 COMPILER V9.01   LCD1602                                                               03/15/2019 13:35:33 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN lcd1602.OBJ
COMPILER INVOKED BY: E:\keil C51\C51\BIN\C51.EXE lcd1602.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************
   2                                                          巫妖王V2.0开发板例程
   3                                     朱有鹏物联网大讲堂出品(www.zhulaoshi.org)      
   4                            技术支持和学习讨论请加朱有鹏单片机学习1群 214959925获取
   5          **********************************************************************
   6          模块名称：LCD1602
   7          模块功能: 16*2 ASCII字符显示液晶显示器（工业级）                
   8          硬件接线：插入LCD1602，注意别接反了，参考图“15.1.LCD1602接法.jpg”，注意
   9                            关键点是跳线帽J13必须接下面2个，接错了或不接都不行。
  10          注意事项：(1) 注意插拔LCD1602时先关电，要养成不带电插拔电子设备的好习惯
  11                                    因为大多数电子器件都不像USB那样支持热插拔。
  12                            (2) LCD1602是内置了ASCII码字库的，所以不用自己提供字模。
  13          版    本：V1.00
  14          作    者：朱有鹏（AstonZhu）
  15          时        间：2017.10.26                                                                                          
  16          **********************************************************************/
  17          
  18          /*
  19          **********************************************************************
  20          *                         头文件包含
  21          **********************************************************************
  22          */
  23          #include "lcd1602.h"
  24          
  25          
  26          /*
  27          **********************************************************************
  28          *                         本地全局变量
  29          **********************************************************************
  30          */
  31          //sbit gLcd1602_E        = P2^7;                        // LCD1602控制总线的使能信号
  32          //sbit gLcd1602_RW = P2^5;                      // LCD1602控制总线的读写选择信号
  33          //sbit gLcd1602_RS = P2^6;                      // LCD1602控制总线的数据/命令选择信号
  34          sbit gLcd1602_E  = P3^4;                        // LCD1602控制总线的使能信号
  35          sbit gLcd1602_RW = P3^6;                        // LCD1602控制总线的读写选择信号
  36          sbit gLcd1602_RS = P3^5;                        // LCD1602控制总线的数据/命令选择信号
  37          
  38          /*
  39          **********************************************************************
  40          *                         内部函数原型声明
  41          **********************************************************************
  42          */
  43          static void delay5ms(void);
  44          static void Lcd1602WaitNoBusy(void);
  45          static void Lcd1602WriteCmd(u8 cmd);
  46          static void Lcd1602WriteData(u8 dat);
  47          
  48          
  49           
  50          /*********************************************************************
  51          * 函 数 名       : Lcd1602WaitNoBusy
  52          * 函数功能               : 阻塞等待LCD1602直到不忙状态
  53          * 参数列表       : 无
  54          * 函数输出       : 无
  55          *********************************************************************/
C51 COMPILER V9.01   LCD1602                                                               03/15/2019 13:35:33 PAGE 2   

  56          static void Lcd1602WaitNoBusy(void)  //忙检测函数，判断bit7是0，允许执行；1禁止
  57          {
  58   1          u8 sta = 0;      //
  59   1      
  60   1          LCD1602_DATA_PORT = 0xff;
  61   1          gLcd1602_RS = 0;
  62   1          gLcd1602_RW = 1;
  63   1          do
  64   1          {
  65   2              gLcd1602_E = 1;
  66   2              sta = LCD1602_DATA_PORT;
  67   2              gLcd1602_E = 0;    //使能，用完就拉低，释放总线
  68   2          }while(sta & 0x80);
  69   1      }
  70          
  71          
  72          /*********************************************************************
  73          * 函 数 名       : Lcd1602WriteCmd
  74          * 函数功能               : 按照LCD1602低层时序向LCD内部写入8位命令字
  75          * 参数列表       : cmd - 待写入的8位命令字
  76          * 函数输出       : 无
  77          *********************************************************************/
  78          static void Lcd1602WriteCmd(u8 cmd)       
  79          {
  80   1              Lcd1602WaitNoBusy();            // 先等待LCD1602处于不忙状态
  81   1      
  82   1              gLcd1602_E = 0;                 // 禁止LCD
  83   1              gLcd1602_RS = 0;                        // 选择发送命令模式
  84   1              gLcd1602_RW = 0;                        // 选择写入模式 
  85   1              LCD1602_DATA_PORT = cmd;    // 将1字节命令字放入8位并行数据端口
  86   1              gLcd1602_E = 1;                 // 使能LED
  87   1              gLcd1602_E = 0;                         // 禁止LCD
  88   1      }
  89          
  90          
  91          /*********************************************************************
  92          * 函 数 名       : Lcd1602WriteData
  93          * 函数功能               : 按照LCD1602低层时序向LCD内部写入8位数据
  94          * 参数列表       : cmd - 待写入的8位命令字
  95          * 函数输出       : 无
  96          *********************************************************************/
  97          static void Lcd1602WriteData(u8 dat)                    
  98          {
  99   1              Lcd1602WaitNoBusy();            // 先等待LCD1602处于不忙状态
 100   1      
 101   1              gLcd1602_E = 0;                 // 禁止LCD
 102   1              gLcd1602_RS = 1;                        // 选择发送数据模式
 103   1              gLcd1602_RW = 0;                        // 选择写入模式 
 104   1              LCD1602_DATA_PORT = dat;    // 将1字节命令字放入8位并行数据端口
 105   1              gLcd1602_E = 1;                 // 使能LED
 106   1              gLcd1602_E = 0;                         // 禁止LCD
 107   1      }
 108          
 109          
 110          /*********************************************************************
 111          * 函 数 名       : Lcd1602Init
 112          * 函数功能               : 按照LCD1602低层时序进行初始化序列
 113          * 参数列表       : 无
 114          * 函数输出       : 无
 115          *********************************************************************/
 116          void Lcd1602Init(void)                                          
 117          {
C51 COMPILER V9.01   LCD1602                                                               03/15/2019 13:35:33 PAGE 3   

 118   1              Lcd1602WriteCmd(0x38);          // 按照数据手册的初始化时序，先发送38H
 119   1              delay5ms();                                     // 延时5ms
 120   1              Lcd1602WriteCmd(0x38);          // 按照数据手册的初始化时序，先发送38H
 121   1              delay5ms();                                     // 延时5ms
 122   1              Lcd1602WriteCmd(0x38);          // 按照数据手册的初始化时序，先发送38H
 123   1              delay5ms();                                     // 延时5ms
 124   1              Lcd1602WriteCmd(0x38);          // 显示模式设置
 125   1              Lcd1602WriteCmd(0x08);          // 关闭显示
 126   1              Lcd1602WriteCmd(0x01);          // 清屏（同时清数据指针）
 127   1              Lcd1602WriteCmd(0x06);          // 读写后指针自动加1，写1个字符后整屏显示不移动
 128   1              Lcd1602WriteCmd(0x0c);          // 开显示，不显示光标
 129   1      }
 130          
 131          
 132          /************* 上面是底层时序函数，下面是高层时序函数 **************/
 133          
 134          /*********************************************************************
 135          * 函 数 名       : Lcd1602SetCursor
 136          * 函数功能               : 本函数用来设置当前光标位置，其实就是设置当前正在编辑
 137          *                                  的位置，其实就是内部的数据地址指针，其实就是RAM显存
 138          *                                  的偏移量
 139          * 参数列表       : x - 横向坐标，范围是0-15
 140          *                                  y - 纵向坐标，0表示上面一行，1表示下面一行
 141          * 函数输出       : 无
 142          *********************************************************************/
 143          void Lcd1602SetCursor(u8 x, u8 y)       // 坐标显示
 144          {
 145   1          u8 addr = 0;
 146   1      
 147   1              switch (y)
 148   1              {
 149   2                      case 0:                                         // 上面一行
 150   2                              addr = 0x00 + x;                break;  
 151   2                      case 1:                                         // 下面一行
 152   2                              addr = 0x40 + x;                break;
 153   2                      default:
 154   2                                                                              break;
 155   2              }
 156   1          Lcd1602WriteCmd(addr | 0x80);
 157   1      }
 158          
 159          
 160          /*********************************************************************
 161          * 函 数 名       : Lcd1602ShowStr
 162          * 函数功能               : 从坐标(x,y)开始显示字符串str，注意这个函数不能跨行
 163          *                                  显示，因为显存地址是不连续的。
 164          * 参数列表       : x - 横向坐标，范围是0-15
 165          *                                  y - 纵向坐标，0表示上面一行，1表示下面一行
 166          *                                  pStr - 指向待显示的字符串的指针
 167          * 函数输出       : 无
 168          *********************************************************************/
 169          void Lcd1602ShowStr(u8 x, u8 y, u8 *pStr)     //显示字符串
 170          {
 171   1          Lcd1602SetCursor(x, y);      //当前字符的坐标
 172   1          while (*pStr != '\0')
 173   1          {
 174   2              Lcd1602WriteData(*(pStr++));
 175   2          }
 176   1      }
 177          
 178          
 179          /*********************************************************************
C51 COMPILER V9.01   LCD1602                                                               03/15/2019 13:35:33 PAGE 4   

 180          * 函 数 名       : Lcd1602ShowChar
 181          * 函数功能               : 在坐标(x,y)显示一个字符
 182          * 参数列表       : x - 横向坐标，范围是0-15
 183          *                                  y - 纵向坐标，0表示上面一行，1表示下面一行
 184          *                                  pStr - 字符
 185          * 函数输出       : 无
 186          *********************************************************************/
 187          void Lcd1602ShowChar(u8 x, u8 y, u8 Char)     //显示字符
 188          {
 189   1          Lcd1602SetCursor(x, y);      //当前字符的坐标
 190   1          Lcd1602WriteData(Char);
 191   1      }
 192          
 193          
 194          void clear_screen(){Lcd1602WriteCmd(0x01);}     //清屏
 195          
 196          
 197          
 198          /*********************************************************************
 199          * 函 数 名       : delay5ms
 200          * 函数功能               : 单片机小精灵V1.3生成的延时5ms的精确延时函数
 201          * 参数列表       : 无
 202          * 函数输出       : 无
 203          *********************************************************************/
 204          static void delay5ms(void)   //误差 0us
 205          {
 206   1          unsigned char a,b;
 207   1          for(b=19;b>0;b--)
 208   1              for(a=130;a>0;a--);
 209   1      }  
 210          
 211          
 212          
 213          
 214          
 215          
 216          
 217          
 218          
 219          
 220          
 221          
 222          
 223          
 224          
 225          
 226          
 227          
 228          
 229          
 230          
 231          
 232          
 233          
 234          
 235          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    181    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.01   LCD1602                                                               03/15/2019 13:35:33 PAGE 5   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
